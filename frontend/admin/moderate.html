<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moderation Queue — Admin</title>
<link rel="stylesheet" href="../styles.css"></head>
<body>
<header class="app-header"><div class="wrap">
  <div class="brand"><div class="badge">B</div><div><div class="brand-name">BookShare</div><div id="roleChip" class="muted small"></div></div></div>
  <div class="userbar"><div id="whoami" class="muted small"></div><a class="btn ghost" href="#" id="logout">Logout</a></div>
</div></header>

<div class="container shell">
  <aside class="sidebar"><nav class="card nav"><a data-id="dashboard" href="dashboard.html">Dashboard</a>
<a data-id="profile" href="profile.html">View/Edit Profile</a>
<a data-id="notifications" href="notifications.html">Notifications</a>
<a data-id="moderate" href="moderate.html">Moderation Queue</a>
<a data-id="manage-users" href="manage-users.html">Manage Student Profiles</a>
<a data-id="invalid-ads" href="invalid-ads.html">Manage Invalid Ads</a>
<a data-id="site-settings" href="site-settings.html">Site Settings</a></nav></aside>
  <main class="card main-panel">
    <div class="titlebar"><h2>Moderation Queue</h2><div></div></div>
    <div><table><thead><tr><th>ID</th><th>Title</th><th>Submitted By</th><th>Size</th><th>Action</th></tr></thead><tbody><tr><td>9001</td><td>OS Notes — Midterm</td><td>Riya</td><td>2.4 MB</td><td><button class="btn success">Approve</button> <button class="btn red">Reject</button></td></tr></tbody></table></div>
  </main>
</div>
<script src="../js/auth.js"></script>
<script>
ensureRole('admin');
activateNav('moderate');
document.getElementById('logout').addEventListener('click', (e)=>{ e.preventDefault(); logoutUp(); });
</script>
</body></html>
<script src="../js/auth.js"></script>
<script>
ensureRole('admin');
activateNav('moderate');
(async ()=>{
  const res = await apiListMaterials();
  const tbody = document.querySelector('tbody'); tbody.innerHTML='';
  res.filter(x=>!x.verified).forEach(m=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${m.id}</td><td>${m.subject}</td><td>${m.uploaded_by?.name||'-'}</td><td>${m.filename}</td><td>
      <button class="btn success" data-id="${m.id}">Approve</button> <button class="btn danger">Reject</button></td>`;
    tbody.appendChild(tr);
  });
  document.querySelectorAll('button.success').forEach(btn=>btn.addEventListener('click', async ()=>{
    const id = btn.getAttribute('data-id');
    const r = await fetch(`${API_BASE}/materials/${id}/verify/`, {method:'POST', headers: authHeader()});
    if(r.ok){ alert('Verified'); location.reload(); } else { alert('Failed'); }
  }));
})();
</script>
